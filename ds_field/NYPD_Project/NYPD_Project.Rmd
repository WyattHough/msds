---
title: "NYPD Project"
author: "W. Hough"
date: "2022-09-11"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Import and Inspect Data

Import required packages
```{r, message=FALSE}
library("tidyverse")
library("lubridate")
```


The NYPD Shooting Incident Data (Historic) data set is imported from this site: https://catalog.data.gov/dataset, and goes back to 2006.
The data is cleaned during import to remove unknown data types and replace them with NA's.

```{r, message=FALSE}
na_strings <- c("UNKNOWN", "U", "", "1020", "940", "224")
#nypd_data <- read_csv("https://data.cityofnewyork.us/api/views/833y-fsy8/rows.csv?accessType=DOWNLOAD", na = na_strings)
nypd_data <- read_csv("NYPD_Shooting_Incident_Data__Historic_.csv", na = na_strings)
summary(nypd_data)
```
## Tidying
We will tidy the data set by removing columns we are uninterested in and adjusting the date format.

First we will use BORO as our location groupings because the general public will understand these locations better than the numbers indicated by the other columns. Therefore, we will remove the other columns related to location. (If we were to present this to law enforcement, then we could perform the following analyses on tighter location bounds)

Next we will convert the date strings into datetime objects.
```{r}
nypd_data_cleaned <- nypd_data %>% 
  select(-c(PRECINCT, JURISDICTION_CODE, X_COORD_CD, Y_COORD_CD, Latitude, Longitude, Lon_Lat)) %>%
  mutate(OCCUR_DATE = mdy(OCCUR_DATE)) %>%
  rename(DATE = OCCUR_DATE, TIME = OCCUR_TIME)
summary(nypd_data_adjusted)
```

Lets see what the BORO locations are and what the age, sex, and race groups are.

```{r}
writeLines("Boro")
unique(nypd_data_cleaned$BORO)
writeLines("\nAge Groups")
union(nypd_data_cleaned$PERP_AGE_GROUP, nypd_data_cleaned$VIC_AGE_GROUP)
writeLines("\nRace")
union(nypd_data_cleaned$PERP_RACE, nypd_data_cleaned$VIC_RACE)
writeLines("\nSex")
union(nypd_data_cleaned$PERP_SEX, nypd_data_cleaned$VIC_SEX)


```

## Visualize the data

We will first visualize the dataset by showing the total number of murders per region. The graph is generated by grouping the data by Boro and adding up the number of murders for each region.

```{r}
murders_by_region <- nypd_data_cleaned %>%
  group_by(BORO) %>%
  summarize(total_murders = sum(STATISTICAL_MURDER_FLAG)) %>%
  ungroup()
```

Generate a bar graph to display the total murders by region.

```{r}
murders_by_region %>%
  ggplot(aes(x = BORO, y = total_murders)) +
  geom_col()
```
## Analysis and Visualization

This graph shows that there are more murders in Brooklyn as compared to the other regions in NYC, with Bronx having the second most. This leads us to wonder what percentage of shootings resulted in murders and how this has changed over time? The previous graph simply shows totals from 2006 to present. The following graph will chart the change in murder rates for each Boro with respect to time.

```{r}
murder_rate_by_region <- nypd_data_cleaned %>%
  group_by(DATE) %>%
  summarize(murders_per_shooting = sum(STATISTICAL_MURDER_FLAG) / nrow(BORO)) %>%
  ungroup()

murder_rate_by_region
```

```{r}
murder_rate_by_region %>%
  ggplot(aes(x = DATE, y = murders_per_shooting))
```
