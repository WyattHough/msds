---
title: "NYPD Project"
date: "2022-09-11"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Import Data

Import required packages
```{r, message=FALSE}
library("tidyverse")
library("lubridate")
```


The NYPD Shooting Incident Data (Historic) data set is imported from this site: https://catalog.data.gov/dataset, and goes back to 2006.
The data contains information about shooting incidents including the region, perpetrator and victom age, race, and sex, and whether or not the incident was a murder. The data is cleaned during import to remove unknown data types and replace them with NA's. We will investigate this data and look for the murder rates for shootings in each region and try to determine if the murder rates change over time.

```{r, message=FALSE}
na_strings <- c("UNKNOWN", "U", "", "1020", "940", "224")
nypd_data <- read_csv("https://data.cityofnewyork.us/api/views/833y-fsy8/rows.csv?accessType=DOWNLOAD", na = na_strings)
summary(nypd_data)
```
## Tidying
We will tidy the data set by removing columns we are uninterested in and adjusting the date format.

First we will use BORO as our location groupings because the general public will understand these locations better than the numbers indicated by Lat, Long or x and y coordinates. Therefore, we will remove the other columns related to location. (If we were to present this to law enforcement, then we could perform the following analyses on tighter location bounds)

Next we will convert the date strings into datetime objects.
```{r, message=FALSE}
nypd_data_cleaned <- nypd_data %>% 
  select(-c(PRECINCT, JURISDICTION_CODE, X_COORD_CD, Y_COORD_CD, Latitude, Longitude, Lon_Lat)) %>%
  mutate(OCCUR_DATE = mdy(OCCUR_DATE)) %>%
  rename(DATE = OCCUR_DATE, TIME = OCCUR_TIME)
summary(nypd_data_cleaned)
```

Lets see what all the BORO locations are.

```{r, echo = FALSE, message=FALSE}
unique(nypd_data_cleaned$BORO)
```


## Visualization

We will first visualize the dataset by showing the total number of murders per region. The graph is generated by grouping the data by Boro and summing the number of murders for each region.

```{r, message=FALSE}
murders_by_region <- nypd_data_cleaned %>%
  group_by(BORO) %>%
  summarize(total_murders = sum(STATISTICAL_MURDER_FLAG)) %>%
  ungroup()
```

Generate a bar graph to display the total murders by region.

```{r, message=FALSE}
murders_by_region %>%
  ggplot(aes(x = BORO, y = total_murders)) +
  geom_col()
```



The next graph will show the number of murders as a percentage of shootings for each region.

```{r, message=FALSE}
murder_rate_by_region <- nypd_data_cleaned %>%
  group_by(BORO) %>%
  summarize(murder_rate = 100 * sum(STATISTICAL_MURDER_FLAG) / (sum(STATISTICAL_MURDER_FLAG) + sum(!STATISTICAL_MURDER_FLAG))) %>%
  ungroup()

murder_rate_by_region %>%
  ggplot(aes(x = BORO, y = murder_rate)) +
  geom_col()
```



## Analysis

This graph shows that there are more murders in Brooklyn as compared to the other regions in NYC, with Bronx having the second most. Even though there were more murders in those regions though, the rate of murders to crime was about even across all the boro's. This leads us to believe that there are more crimes in Brooklyn and the Bronx as compared to the other regions. Let's see if this conclusion holds up consistently over time or if there were simply a few years with high numbers of murders in the area. The following graphs will chart the change in murder rates for each Boro with respect to time.

```{r}
murder_rate_by_region <- nypd_data_cleaned %>%
  group_by(BORO, DATE) %>%
  summarize(murders = sum(STATISTICAL_MURDER_FLAG),
            crimes = sum(STATISTICAL_MURDER_FLAG) + sum(!STATISTICAL_MURDER_FLAG)) %>%
  mutate(running_murder_rate = 100 * cumsum(murders) / cumsum(crimes)) %>%
  select(BORO, DATE, running_murder_rate) %>%
  ungroup()

region <- "BROOKLYN"
murder_rate_by_region %>%
  filter(BORO == region) %>%
  ggplot(aes(x = DATE, y = running_murder_rate)) +
  geom_line(aes(color = "running_murder_rate")) +
  geom_point(aes(color = "running_murder_rate")) +
  theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 90)) +
  labs(title = str_c("Murder Rate in ", region), y = NULL)

region <- "BRONX"
murder_rate_by_region %>%
  filter(BORO == region) %>%
  ggplot(aes(x = DATE, y = running_murder_rate)) +
  geom_line(aes(color = "running_murder_rate")) +
  geom_point(aes(color = "running_murder_rate")) +
  theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 90)) +
  labs(title = str_c("Murder Rate in ", region), y = NULL)

region <- "MANHATTAN"
murder_rate_by_region %>%
  filter(BORO == region) %>%
  ggplot(aes(x = DATE, y = running_murder_rate)) +
  geom_line(aes(color = "running_murder_rate")) +
  geom_point(aes(color = "running_murder_rate")) +
  theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 90)) +
  labs(title = str_c("Murder Rate in ", region), y = NULL)

region <- "QUEENS"
murder_rate_by_region %>%
  filter(BORO == region) %>%
  ggplot(aes(x = DATE, y = running_murder_rate)) +
  geom_line(aes(color = "running_murder_rate")) +
  geom_point(aes(color = "running_murder_rate")) +
  theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 90)) +
  labs(title = str_c("Murder Rate in ", region), y = NULL)

region <- "STATEN ISLAND"
murder_rate_by_region %>%
  filter(BORO == region) %>%
  ggplot(aes(x = DATE, y = running_murder_rate)) +
  geom_line(aes(color = "running_murder_rate")) +
  geom_point(aes(color = "running_murder_rate")) +
  theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 90)) +
  labs(title = str_c("Murder Rate in ", region), y = NULL)

murder_rate_by_region %>%
  ggplot(aes(x = DATE, y = running_murder_rate)) +
  geom_line(aes(color = "running_murder_rate")) +
  geom_point(aes(color = "running_murder_rate")) +
  theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 90)) +
  labs(title = str_c("Murder Rate in New York"), y = NULL)
```

## Conclusion

In conclusion, we see that all of the regions level off to about a 20% murder rate with the Bronx and Brooklyn coming in slightly under that rate. Even though it seemed those regions were worse because they had higher number of total crimes, it turned out they have the lowest murder rate. There may be some bias in this data because of the policing since they are not able to catch every crime. There might be more shootings in some areas that are uncaught because there are less police presence. There also could be bias present by the size of the regions, we would need to perform this analysis further with population data in mind in order to accurately reflect the murder rate with respect to population. We could also do this analysis with smaller region bounds by looking at the coordinates and narrowing it down to specific neighborhoods. My personal bias would have been thinking that the Bronx has the most crime since that is what I have heard about most in the news. The way to mitigate this bias is to apply the same analysis to every region and ensure each one is analyzed equally.



